---
layout: post
title:  "SickOS 1.2 writeup [DONE]"
date:   2017-06-10 13:33:27 +0100
categories: jekyll update
---

[Download this box on VulnHub](https://www.vulnhub.com/entry/sickos-12,144/)

Beginning with an nmap scan, ssh and webserver running.
![Nmap screenshot]({{ site.url }}/assets/sickos12/nmap.PNG)

Checking the site, the image with exiftools and the source code, there doesn't seem to be anything of note.
![Site screenshot]({{ site.url }}/assets/sickos12/site.PNG)

After checking robots.txt (it 404s) i run a nikto scan, again there isn't really anything helpful.
![Nikto screenshot]({{ site.url }}/assets/sickos12/nikto.PNG)

Running a dirb scan points to a /test/ directory.
![Dirb screenshot]({{ site.url }}/assets/sickos12/dirb.PNG)

Checking the test directory seems to show an empty list of files and the lighttpd server version.
![test screenshot]({{ site.url }}/assets/sickos12/test.PNG)

Checking searchsploit for lighthttp, nothing that will help us unfortunately.
![test screenshot]({{ site.url }}/assets/sickos12/searchsploit.PNG)

I was stuck for quite a while here, throwing tools at the site wasn't really working, eventually I tried POSTing to the /test/ url with firefox devtools and I got a 200 back, using curl I found that the server was accepting loads of different HTTP methods it shouldn't have been.
![httpoptions screenshot]({{ site.url }}/assets/sickos12/httpoptions.PNG)


I uploaded a reverse php shell generated by msfvenom with curl with the PUT method to /test/, started a netcat listener and then hit it in the browser. Port 4444 seemed blocked, 80 didn't seem to work either but eventually I had luck with 443 (open for https i assume).
![Shell screenshot]({{ site.url }}/assets/sickos12/shell.PNG)
![Shell1 screenshot]({{ site.url }}/assets/sickos12/shell1.PNG)

I checked bash history and permission of my use (the shell was under www-data user). I ran the [enumeration script](https://github.com/rebootuser/LinEnum) (loading it through the same upload as before then navigating to the folder) and looked for possible escalation methods.
![linenum screenshot]({{ site.url }}/assets/sickos12/linenum.PNG)

After a long time of searching through dead ends and almost giving up, I found that chkrootkit was running as a daily cron job, it was an outdated version by the looks.
![chkrootkit screenshot]({{ site.url }}/assets/sickos12/chkrootkit.PNG)

Checking searchsploit and then exploit.db I found that if I put a script "update" in /tmp it would be executed by cron (as root). I added a script that added the www-data user to sudoers.

![Searchsploit2 screenshot]({{ site.url }}/assets/sickos12/searchsploit2.PNG)

After a bit of fiddling, first waiting a while before realising I didnt make the file update executable..
..then having to change the script a little to chmod /etc/sudoers instead of calling sudo sh -c...
![Rooting screenshot]({{ site.url }}/assets/sickos12/rooting.PNG)

..and then forgetting sudo su doesn't work if /etc/sudoers is world read/write/exec, so having to do it again setting permissions back too.

![Oops screenshot]({{ site.url }}/assets/sickos12/oops.PNG)

..and after a few moments (even though I was expecting to wait hours until the daily job would run)
Rooted.

![Rooted screenshot]({{ site.url }}/assets/sickos12/rooted.PNG)

Checking flag.
![Flag screenshot]({{ site.url }}/assets/sickos12/flag.PNG)

All done.

I think there was a metasploit module I could use to root with chkrootkit, but I wanted to avoid it and attempt to do it manually.

